# Data Archiving Reference

## Data Archiving Logic<logic>
Data ingested from devices and data generated by stream processing can be archived based on data event time or system time. The generated archive files can be synchronized automatically to the specified storage system as per the storage path information. When setting the storage path, you can determine the file generation mode by selecting to generate the directory by event time or system time.

If you select to generate the directory by the event time, the data content will be parsed and the data event time will be obtained. Then, the data in the same time partition will be written to the same file. Finally, the generated files will be synchronized to the corresponding directory. If you select to generate the directory by the system time, the data in the same time partition will be written to the same file as per the system time stamp of data. Finally, the generated files will be synchronized to the corresponding directory.

## Storage Path Partition Parameters<path>
After specifying the root directory for storing the archive files and the path generation method, you can select different time partition parameter formats. Four time partition parameter formats are supported currently, which are described as follows:

.. list-table::
   :widths: 20 30 50

   * - Parameter Format
     - Description
     - Example
   * - YYYYMMDD
     - Generating directories by day
     - /bucketName/samplePath/20190101/
   * - YYYYMMDD/HH
     - Generating directories by day/hour
     - /bucketName/samplePath/20190101/00/
   * - YYYY/MM/DD
     - Generating directories by year/month/day
     - /bucketName/samplePath/2019/01/01/
   * - YYYY/MM/DD/HH
     - Generating directories by year/month/day/hour
     - /bucketName/samplePath/2019/01/01/00/

## Archiving Cycle Configuration<cycle>
The archiving cycle determines the time interval to trigger the data archiving jobs. The longer the archiving cycle is, the more data you can be processed in the cycle.

Currently, the data archiving policy supports 1 hour, 6 hours, 12 hours and 24 hours as the archiving cycle. Different archiving cycles mean different scheduled starting time to trigger the archiving jobs as well as different data range. For example:

.. list-table::
   :widths: 20 40 40

   * - Archiving Cycle
     - Scheduled Job Starting Time
     - Archived Data
   * - 1 hour
     - 00:00:00, 01:00:00, 02:00:00, ..., 23:00:00
     - Taking 01:00:00 for example, data to be archived falls in  [00:00:00, 01:00:00).
   * - 6 hours
     - 00:00:00, 06:00:00, 12:00:00, 18:00:00
     - Taking 6:00:00 AM for example, data to be archived falls in [00:00:00, 6:00:00 AM).
   * - 12 hours
     - 00:00:00, 12:00:00
     - Taking 12:00:00 PM for example, data to be archived falls in [00:00:00, 12:00:00 PM).
   * - 24 hours
     - 00:00:00
     - Taking 2019-01-02 00:00:00 for example, data to be archived falls in [2019-01-01 00:00:00, 2019-01-02 00:00:00)

.. note:: - The data archiving cycle adopts the system time stamp. If the system time stamp of data is within the current archiving cycle, the data will be archived as per the policy configuration and synchronized to the corresponding storage path.
  - When data archiving policy is submitted, the system starts reading data from the specified message channel. However, in the first archiving cycle when the archiving policy is submitted, data will not be cached, so no archived file will be generated. Data will be archived from the next archiving cycle after the policy is submitted. If a policy is updated to add models, data of the new models will also be archived starting from the next archiving cycle after the updated policy is submitted.

## Generation of Archived Files<file>

The logic of generating archived files is as follows:

In an archiving cycle, the archiving job will be triggered to generate the archived file only when the first data record arrives. If no data arrives in the archiving cycle, no file or path will be created.

When **Real-time Message Channel** and **Generate path by event time** are selected in the archiving policy, if the event time of the uploaded data is 1 hour later than the system time or 360 hours earlier than the system time, the archived files will be stored in a folder named `archive_recycling_${filename}` under the specified root directory (in which `filename` is the specified name for the archived file in the policy).

The columns of the archived file are as follows:

.. list-table::
   :widths: 40 60

   * - Field Name
     - Field Description
   * - orgId
     - Organization ID
   * - modelId
     - Model Identifier
   * - assetId
     - Asset ID
   * - measurepoints
     - Measuring point name
   * - timestamp
     - Event time of measuring point
   * - value
     - Value of measuring point
   * - quality
     - Data quality

<!--end-->
